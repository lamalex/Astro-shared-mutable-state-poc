---
import FootnoteRef from '../components/FootnoteRef.astro';
import FootnotePageLayout from '../components/FootnotePageLayout.astro';
import { FootnoteManager } from '../lib/footnote-manager';
import { ContentUtils } from '../lib/content-utils';

// Setup page content using our new abstractions
const { articles, additionalContent } = await ContentUtils.createArticlePage({
  articleOrder: 'by-order',
  additionalContent: [
    { collection: 'animals', slug: 'frogs' }
  ]
});

// Create footnote manager with deferred footnotes and content
const { registry, renderedContent } = await FootnoteManager.createForPage({
  deferredFootnotes: [
    { id: 'OPENCODE_001', deferred: true },
    { id: 'GITHUB_REPO', deferred: true }
  ],
  content: [...articles, ...additionalContent]
});

// Separate articles from additional content for rendering
const renderedArticles = renderedContent.slice(0, articles.length);
const renderedAdditionalContent = renderedContent.slice(articles.length);
---

<FootnotePageLayout
  registry={registry}
  articles={renderedArticles}
  additionalContent={renderedAdditionalContent}
  title="Multi-Article Footnotes System"
>
  <Fragment slot="header">
    <p class="subtitle">
      Demonstrating footnote numbering across multiple MDX articles 
      with a single footnotes list at the bottom. Built live in OpenCode<FootnoteRef id="OPENCODE_001" registry={registry} defer={true} /> with source code on GitHub<FootnoteRef id="GITHUB_REPO" registry={registry} defer={true} />!
    </p>
  </Fragment>
  
  <Fragment slot="navigation">
    <a href="/advanced">View Advanced Page â†’</a>
  </Fragment>
</FootnotePageLayout>
